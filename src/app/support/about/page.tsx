import Link from 'next/link';

async function getLatestRelease() {
  const headers: Record<string, string> = {
    Accept: 'application/vnd.github+json',
    'X-GitHub-Api-Version': '2022-11-28',
  };
  if (process.env.GITHUB_TOKEN) {
    headers.Authorization = `Bearer ${process.env.GITHUB_TOKEN}`;
  }

  const isDev = process.env.NODE_ENV === 'development';
  const fetchOptions = isDev
    ? ({ headers, cache: 'no-store' as const })
    : ({ headers, next: { revalidate: 3600 } as const });

  const res = await fetch(
    'https://api.github.com/repos/chavezroy/pastree-website/releases?per_page=1',
    fetchOptions
  );

  if (!res.ok) {
    return {
      version: '1.0',
      buildDate: new Date().toISOString()
    };
  }

  type GithubRelease = {
    published_at: string;
    name?: string;
    tag_name: string;
    html_url: string;
  };

  const data: GithubRelease[] = await res.json();
  if (data.length === 0) {
    return {
      version: '1.0',
      buildDate: new Date().toISOString()
    };
  }

  const latestRelease = data[0];
  return {
    version: latestRelease.tag_name,
    buildDate: latestRelease.published_at
  };
}

export default async function AboutPage() {
  const releaseData = await getLatestRelease();

  return (
    <>
  
      <div className="min-h-screen bg-pastree-light py-20">
        <div className="container mx-auto px-4">
          <div className="max-w-2xl mx-auto">
            <div className="text-center mb-12">
              <h1 className="text-4xl font-bold mb-4">About Pastree</h1>
            </div>

            <div className="bg-white rounded-xl shadow-lg p-8 grid grid-cols-1 lg:grid-cols-2">
             
              <div>
              <p>
                Pastree Extension<br /> <br />
                Version: {releaseData.version}<br />
                Built: {new Date(releaseData.buildDate).toLocaleDateString('en-US', {
                  month: 'short', 
                  day: 'numeric', 
                  year: 'numeric'
                })}
              </p>    
              <p className='my-4'>&copy; {new Date().getFullYear()}. All Rights Reserved.</p>
              <p><Link href="/support" className='text-pastree-orange inline-flex items-center gap-1 hover:underline'>Get Pastree support <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg></Link>
              </p>   
              </div>
              <div>
              <svg className="w-full h-full mx-auto pl-5" viewBox="0 0 48 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <style>{`
                    .cls-1 { fill: #ed8e5b; }
                    .cls-2 { fill: #fff; }
                  `}</style>
                </defs>
                <g>
                  <path className="cls-1" d="M5.38,8.63c1.78.47,2.32,1.54,2.19,2.74-.22.06-.46.11-.71.15-1.67.28-4.97-.97-5.01-.99.03.02,2.39,1.58,4.77,1.63.3,0,.57,0,.8-.04-.41,1.34-1.42,2.22-3.4,1.7-2.06-.54-4.02-3.84-4.02-3.84,0,0,3.32-1.9,5.38-1.36Z" />
                  <path className="cls-1" d="M28.34,4.44C23.95-1.91,9.75-1.77,7.93,6.94c-.66,6.18-.16,12.46-.32,18.68.04.58-1.12,1.33-.82,1.54.3.21,3.63-.2,4.17-.17,1.2.08,1.75.21,2.93.1.25-.02.85.11.82-.2,0-.04-.28-.34-.31-.38-.2-.34-.7-1.03-.8-1.35-.22-.71-.18-2.71-.11-3.57,0-.1-2.59-1.85-3.02-3.47,0,0,1.43,1.44,4.38,2.25,4.56,1.27,10.7-.02,13.69-4.81,1.98-3.19,1.96-8.01-.19-11.12ZM27.51,9.48c-.06.22-.28.44-.36.6-.27.59-.28,3.78-.74,3.93-.48.15-.24-1.82-.41-1.65-2.07,2.09-1.35,3.11-1.91,3.36-.41.18-.67-.92-1.18-.65-.39.21-.96.81-1.32.9-.42.11-1,0-1.46.04-.04,0-.08.02-.12.02-.06.01-.12.03-.18.05-1.1.43-1.36,2.54-2.14,2.6-.68.05-.82-2.15-1.37-2.15-.22,0-.49.11-.72.12-1.05.08-1.58.82-2.02.1-.78-1.29-1.87-.78-2.57-1.5-.27-.28-.37-.74-.09-.95.04-.06.13-.1.3-.11,1.09-.09,1.56.6,2.39.97.87.39,1.75-.1,2.71-.01.65.06.85.37,1.74.3,2.65-.19,7.09-2.76,7.76-5.5.15-.6.2-1.16.19-1.7-.1-3.77-3.87-6.07-7.65-6.1-3.06-.02-7.01,1.48-7.75,4.8-.1.44-.14.85-.13,1.23.08,2.69,2.66,4.06,5.41,4.03,2.34-.03,6.69-1.57,6.62-4.43,0-.19-.03-.39-.07-.59-.69-3.06-5.65-3.07-7.65-1.4-.66.55-1,1.32-.95,2.01.06.7.51,1.33,1.43,1.61.87.26,2.43.06,3.12-.56.27-.24.39-.5.4-.75.03-.74-.89-1.33-1.58-.73-.25.22-.69.9-1.06.44-.1-.12-.14-.26-.14-.41,0-.14.04-.29.09-.43.68-1.59,4.27-.63,4.34.98,0,.11,0,.22-.03.33-.45,1.82-3.72,2.55-5.29,2.18-1.55-.37-2.56-1.48-2.55-2.76,0-.58.21-1.21.69-1.81.67-.86,2.2-1.83,3.31-2,.36-.06.77.03,1.12-.02.24-.04.43-.2.73-.23,1.95-.2,5.33,1.52,5.55,3.68.02.19.03.38.03.56-.02,2.71-2.4,4.47-4.84,5.25-2.05.66-5.73.62-7.55-.65-1.63-1.14-2.33-2.66-2.31-4.21.02-1.99,1.2-4.02,3.07-5.34.82-.58,2.67-1.34,3.65-1.51.57-.09,1.27.01,1.79-.07.92-.14,1.16-.36,2.21-.23,1.29.16,1.67.34,2.79.87.63.3,1.26.37,1.79.88.36.34.7.66,1.07,1,.52.46,1.48,1.86,1.53,2.55,0,0,0,0,0,0,0,0,0,0,0,0,.02.23-.07.46-.05.64.07.6.35,1.11.39,1.73.01.21,0,.42-.07.66Z" />
                  <path className="cls-2" d="M24.64,2.91c.36.34.7.66,1.07,1,.52.46,1.48,1.86,1.53,2.55.02.24-.07.46-.05.64.09.8.57,1.44.32,2.38-.06.22-.28.44-.36.6-.27.59-.28,3.78-.74,3.93-.48.15-.24-1.82-.41-1.65-2.07,2.09-1.35,3.11-1.91,3.36-.41.18-.67-.92-1.18-.65-.39.21-.96.81-1.32.9-.42.11-1,0-1.46.04-1.36.12-1.59,2.61-2.43,2.67-.68.05-.82-2.15-1.37-2.15-.22,0-.49.11-.72.12-1.05.08-1.58.82-2.02.1-.78-1.29-1.87-.78-2.57-1.5-.35-.36-.42-1,.21-1.05,1.09-.09,1.56.6,2.39.97.87.39,1.75-.1,2.71-.01.65.06.85.37,1.74.3,2.65-.19,7.09-2.76,7.76-5.5,1.16-4.78-3.14-7.78-7.46-7.81-3.06-.02-7.01,1.48-7.75,4.8-.78,3.51,2.14,5.3,5.28,5.27,2.5-.03,7.28-1.78,6.55-5.03-.69-3.06-5.65-3.07-7.65-1.4-1.32,1.11-1.36,3.07.48,3.63.87.26,2.43.06,3.12-.56,1.08-.97-.26-2.29-1.17-1.49-.25.22-.69.9-1.06.44-.2-.25-.16-.56-.05-.83.72-1.69,4.75-.5,4.31,1.3s-3.72,2.55-5.29,2.18c-2.25-.54-3.37-2.62-1.86-4.56.67-.86,2.2-1.83,3.31-2,.36-.06.77.03,1.12-.02.24-.04.43-.2.73-.23,1.95-.2,5.33,1.52,5.55,3.68.32,3.02-2.22,4.96-4.81,5.8-2.05.66-5.73.62-7.55-.65-3.73-2.6-2.56-7.19.76-9.54.82-.58,2.67-1.34,3.65-1.51.57-.09,1.27.01,1.79-.07.92-.14,1.16-.36,2.21-.23,1.29.16,1.67.34,2.79.87.63.3,1.26.37,1.79.88Z" />
                </g>
              </svg>
            </div>
              <div>
                
              </div>
                
            </div>
          </div>
        </div>
      </div>
    </>
  );
}
